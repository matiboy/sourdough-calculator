<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Sourdough calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.min.js"></script>
  <script src="https://unpkg.com/vue-i18n@8.11.2/dist/vue-i18n.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.7.0/js/all.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuex-persist"></script>
  <script src="https://unpkg.com/vuex@3.1.1/dist/vuex.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/node-uuid/1.4.8/uuid.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.30.1/date_fns.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jump.js/1.0.2/jump.min.js" integrity="sha256-nLkfxAF8lAuFgs9kcFqZff/MohZAA8mNLQ/buYWwOLs=" crossorigin="anonymous"></script>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.0/css/bulma.min.css">
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-66908765-36"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-66908765-36');
  </script>

  <style>
    ol li {
      margin-bottom: 10px;
    }
    .double-flash {
      animation: double-flash_6492 4s ease infinite;
      transform-origin: 50% 50%;
    }

    .total {
      border-top: solid 4px black;
    }
    
    @keyframes double-flash_6492 {
      0% { opacity:1 }
      12.5% { opacity:0 }
      25% { opacity:1 }
      37.5% { opacity:0 }
      50% { opacity:1 }
      100% { opacity:1 }
    }

    #step3_box {
      display: none;
    }

    #tabs_section {
      padding-top: 0;
    }

    .hero {
      background-color: aliceblue;
    }

    #roundToDecimalId {
      width: 80px;
      text-align: center;
      margin: 0 5px;
    }
    #copy_button {
      color: black;
      cursor: pointer;
    }
    input[readonly] {
      border: 0;
    }
    table.table th {
      text-align: center;
    }
    .planner-box {
      height: 100px;
      border-top: solid 2px black;
      border-bottom: solid 2px black;
      border-right: solid 1px gray;
      border-left: solid 1px gray;
      margin-bottom: 20px;
      cursor: pointer;
      position: relative;
    }
    .planner-box.on_the_dot {
      border-left: solid 2px black;
    }
    .planner-box level {
      margin-bottom: 0;
    }
    .planner-box_time {
      font-size: 0.85em;
      position: absolute;
      font-weight: bold;
      top: 0;
      left: 0;
      right: 0;
    }
    .planner-box_time span {
      margin: auto;
    }
    #legend .legend {
      max-width: 250px;
      margin-bottom: 10px;
      padding: 4px;
    }
    .planner-box_activity {
      font-size: 50px;
      font-weight: bold;
      position: absolute;
      top: 10px;
      left: 0;
      margin-left: auto;
      margin-right: auto;
      right: 0;
    }
    .planner-box_activity-PO, .planner-box_activity-P, .planner-box_activity-R {
      background-color: limegreen;
    }
    .planner-box_activity-D, .planner-box_activity-F, .planner-box_activity-T {
      background-color: yellow;
    }
    .planner-box_activity-C, .planner-box_activity-C {
      background-color: red;
    }

    .planner-box_activity-doubleAsterisk, .planner-box_activity-asterisk {
      background-color: lightblue;
    }
    .planner-box .add_next, .planner-box .remove_activity {
      position: absolute;
      text-align: center;
      border-radius: 13px;
      vertical-align: middle;
      margin-top: auto;
      margin-bottom: auto;
      bottom: 2px;
      z-index: 10;
    }
    .planner-box .add_next {
      right: 2px;
      color: blue;
    }
    .planner-box .remove_activity {
      left: 2px;
      color: red;
    }
    #tabs_section h2.subtitle {
      font-weight: bold;
      padding-bottom: 15px;
      border-bottom: dotted 1px gray;
    }
    .coefficient_number {
      width: 100px;
    }
    .div_table > div {
      margin-bottom: 10px;
    }
    ol {
      margin-left: 20px;
    }
  </style>
  <script>
    const messages = {
      fr: {
        page: {
          title: 'Calculer le coefficient',
          subtitle: 'Un petit calculateur pour la petite vidéo'
        },
        ingredients: {
          flour: 'farine',
          water: 'eau',
        },
        breads: {
          pain: 'pain | pains',
          baguette: 'baguette | baguettes'
        },
        prompts: {
          clearRecipe: {
            title: 'Tout effacer dans la commande?',
            text: 'Vous êtes sur le point d\'effacer toute la commande!',
            confirmButtonText: 'Oui, effaçons!',
            cancelButtonText: 'Non, surtout pas!',
          },
          clearOrder: {
            title: 'Tout effacer dans la commande?',
            text: 'Vous êtes sur le point d\'effacer toute la commande!',
            confirmButtonText: 'Oui, effaçons!',
            cancelButtonText: 'Non, surtout pas!',
          },
          save: {
            title: 'Votre recette a été enregistrée',
            html: `Veillez à guarder le lien ci-dessous; c'est le seul moyen d'acceder de nouveau à votre recette:
            <p>
              <span><small><i id="url_container">{url}</i></small></span>
              <i id="copy_button" data-clipboard-target="#url_container" class="fas is-right fa-copy"></i>
            </p>
            `
          },
          selectActivity: {
            title: 'Selectionnez l\'activité entre {start} et {end}',
            activities: {
              'none': 'Aucune activité',
              'PO': 'Poolish phase de fermentation',
              'P': 'Pétrissage',
              'D': 'Division',
              'R': 'Rabat',
              'F': 'Façonnage',
              'T': 'Tourage',
              'C': 'Cuisson',
              'asterisk': 'Stockage au Froid positif',
              'doubleAsterisk': 'Stockage au Froid négatif',
            }
          }
        },
        recipes: {
          genericIngredients: {
            water: 'Eau',
            yeast: 'Levure',
            fermentedDough: 'Pâte fermentée',
            salt: 'Sel',
            flour: 'Farine',
            oliveOil: 'Huile d\'olive',
            sourdough: 'Levain liquide',
            egg: 'Œufs',
            sugar: 'Sucre',
            milk: 'Lait',
            butter: 'Beurre',
            dryMilk: 'Dry milk',
          },
          commonBread: {
            title: 'Pain courant (BPàP #19)',
            ingredients: {
              flour: 'Farine T65',
              fermentedDough: 'Pâte fermentée viennoise',
            } 
          },
          pizzaDough: {
            title: 'Pâte à pizza (BPàP #24)',
            ingredients: {
              flour: 'Farine T65',
              polenta: 'Polenta'
            }
          },
          hamburgerDough: {
            title: 'Pain à hamburger (BPàP #26)',
            ingredients: {
              flour: 'Farine T65',
            }
          },
          respectusPanis: {
            title: 'Pain levain Respectus Panis (BPàP #41)',
            ingredients: {
              flour: 'Farine tradition T65',
              flourT80: 'Meule T80',
            }
          },
          meteille: {
            title: 'Meteille (BPàP #46)',
            ingredients: {
              flour: 'Farine tradition T65',
              flourT170: 'Seigle T170',
            }
          },
          sourdoughJack: {
            title: 'Pain au levain de seigle (BwJ #101)',
            ingredients: {
              sourdough: 'Levain au seigle'
            }
          },
          burgerJoshua: {
            title: 'Pain hamburger (Joshua Weissman)',
            ingredients: {
              waterRoux: 'Tanzhong (50% de lait)',
            }
          },
          hokkaido: {
            title: 'Pain "Hokkaido" avec Tanzhong',
            ingredients: {
              waterRoux: 'Tanzhong (83% eau | 1 part de farine pour 5 parts d\'eau)',
            }
          },
          kebab: {
            title: 'Pain Kebab moelleux',
            ingredients: {
              flour: 'Farine T55',
            }
          },
        },
        boxes: {
          order: {
            title: 'Entrez la commande…',
            each: 'à',
            addItem: 'Ajouter un élement',
            clearOrder: 'Effacer la commande'
          },
          recipe: {
            title: '… et la recette de base',
            totalPerKg: 'par kg de farine',
            clearRecipe: 'Effacer la recette',
            addItem: 'Ajouter un élement',
            selectRecipeAfter: 'puis modifiez-la si besoin',
            selectRecipeBefore: 'Choisir une recette',
            selectRecipeSelect: '-',
            selectRecipeCustom: 'Custom',
            suggestedRecipesButton: 'Suggested quantities',
          },
          coefficient: {
            title: 'On calcule le coéfficient…',
            roundCoefficentToBefore: 'Arrondir à',
            roundCoefficentToAfter: 'decimales',
            roundCoefficentToUnit: 'arrondi à l\'unité',
            tabName: 'Coefficient & Ingredients',
            backTo1: 'Retour à la première étape',
            singleIngredient: '{mass}g de {name}',
          },
          measurements: {
            title: '… et les mesures',
          },
          poolish: {
            title: 'Si vous utilisez la méthode Poolish (en option)',
            day1: '1<sup>er</sup> jour',
            day2: '2<sup>ème</sup> jour',
            tabName: 'Méthodes de panification en option'
          },
          waterRoux: {
            title: 'Tangzhong',
            waterRoux: 'Tangzhong',
            balance: 'Reste dans la recette',
          },
          hydration: {
            tabName: 'Taux d\'hydratation',
          },
          planner: {
            key: 'Légende',
            tabName: 'Diagramme de fabrication',
            shortActivities: {
              none: '',
              D: 'D',
              R: 'R',
              PO: 'PO',
              P: 'P',
              F: 'F',
              T: 'T',
              C: 'C',
              asterisk: '*',
              doubleAsterisk: '**',
            },
            startAt: 'Heure de commencement: '
          }
        },
        save: 'Enregistrer',
        add: 'Ajouter',
      },
      en: {
        page: {
          title: 'Compute order coefficient/ingredient measurements',
          subtitle: 'A companion calculator for'
        },
        ingredients: {
          flour: 'flour',
          water: 'water',
        },
        breads: {
          pain: 'bread | breads',
          baguette: 'baguette | baguettes'
        },
        prompts: {
          clearRecipe: {
            title: 'Clear recipe?',
            text: 'This will delete all the items from the recipe!',
            confirmButtonText: 'Yes, clear all!',
            cancelButtonText: 'No, cancel!',
          },
          clearOrder: {
            title: 'Clear order?',
            text: 'This will delete all the items from the order!',
            confirmButtonText: 'Yes, clear all!',
            cancelButtonText: 'No, cancel!',
          },
          save: {
            title: 'Your current order/recipe has been saved',
            html: `Please make sure to keep the url below as there are no other way to recover your recipe:
            <p>
              <span><small><i id="url_container">{url}</i></small></span>
              <i id="copy_button" data-clipboard-target="#url_container" class="fas is-right fa-copy"></i>
            </p>
            `
          },
          selectActivity: {
            title: 'Select activity from {start} to {end}',
            activities: {
              'none': 'No activity',
              'PO': 'Poolish Fermentation phase',
              'P': 'Kneading',
              'R': 'Fold',
              'D': 'Dividing',
              'F': 'Shaping',
              'T': 'Tourage',
              'C': 'Baking',
              'asterisk': 'Fridge',
              'doubleAsterisk': 'Freezer',
            }
          }
        },
        recipes: {
          genericIngredients: {
            water: 'Water',
            yeast: 'Yeast',
            fermentedDough: 'Fermented dough',
            salt: 'Salt',
            flour: 'Flour',
            oliveOil: 'Olive oil',
            sourdough: 'Liquid Sourdough',
            egg: 'Eggs',
            sugar: 'Sugar',
            salt: 'Salt',
            milk: 'Milk',
            butter: 'Butter',
            dryMilk: 'Dry Milk',
            waterRoux: 'Tanzhong',
          },
          commonBread: {
            title: 'Common bread (BPàP #19)',
            ingredients: {
              flour: 'Flour T65',
              fermentedDough: 'Milk bread fermented dough'
            } 
          },
          pizzaDough: {
            title: 'Pizza dough (BPàP #24)',
            ingredients: {
              flour: 'Flour T65',
              polenta: 'Polenta/Cornmeal'
            }
          },
          poolishSesame: {
            title: 'Sesame Poolish',
            ingredients: {
              flour: 'Tradition Flour T65',
              sesame: 'Sesame'
            }
          },
          meteille: {
            title: 'Meteille - Mixed flours (BPàP #46)',
            ingredients: {
              flour: 'Tradition Flour T65',
              flourT170: 'Rye Flour T170',
            }
          },
          burgerJoshua: {
            title: 'Burger Bun (Joshua Weissman)',
            ingredients: {
              waterRoux: 'Tanzhong (50% milk)',
            }
          },
        },
        boxes: {
          order: {
            title: 'Key in order quantity…',
            each: 'each',
            addItem: 'Add item',
            clearOrder: 'Clear order'
          },
          recipe: {
            title: '… and choose (or create) base recipe',
            totalPerKg: 'per kg of flour',
            clearRecipe: 'Clear recipe',
            addItem: 'Add item',
            selectRecipeAfter: 'then edit it below as needed',
            selectRecipeBefore: 'Select a recipe',
            selectRecipeSelect: '-',
            selectRecipeCustom: 'Custom',
            suggestedRecipesButton: 'Suggested quantities',
          },
          coefficient: {
            title: 'Let\'s compute the coefficient…',
            roundCoefficentToBefore: 'Round coefficient to',
            roundCoefficentToAfter: 'decimals',
            roundCoefficentToUnit: 'rounds to nearest number',
            tabName: 'Coefficient/Ingredients',
            backTo1: 'Back to Step 1',
            singleIngredient: '{mass}g of {name}'
          },
          measurements: {
            title: '… and the ingredients you\'ll need',
          },
          poolish: {
            title: 'Poolish method',
            day1: 'Day 1',
            day2: 'Day 2',
            tabName: 'Optional methods'
          },
          waterRoux: {
            title: 'Water Roux a.k.a. Tangzhong',
            waterRoux: 'Water Roux',
            balance: 'Balance in recipe',
          },
          hydration: {
            tabName: 'Hydration',
          },
          planner: {
            key: 'Key',
            tabName: 'Planner',
            shortActivities: {
              none: '',
              D: 'D',
              R: 'F',
              PO: 'PO',
              P: 'K',
              F: 'S',
              T: 'T',
              C: 'B',
              asterisk: '*',
              doubleAsterisk: '**',
            },
            startAt: 'Start at'
          }
        },
        save: 'Save',
        add: 'Add'
      }
    }
    const recipeIngredients = {
      commonBread: [
        {name: 'flour', mass: 5000, count: 1},
        {name: 'water', mass: 3200, count: 1},
        {name: 'salt', mass: 90, count: 1},
        {name: 'yeast', mass: 50, count: 1},
        {name: 'fermentedDough', mass:  1000, count: 1},
      ],
      pizzaDough: [
        {name: 'flour', mass: 1000, count: 1},
        {name: 'water', mass: 580, count: 1},
        {name: 'salt', mass: 20, count: 1},
        {name: 'yeast', mass: 30, count: 1},
        {name: 'polenta', mass: 30, count: 1},
        {name: 'oliveOil', mass: 60, count: 1},
        {name: 'sourdough', mass: 100, count: 1},
      ],
      hamburgerDough: [
        {name: 'flour', mass: 1000, count: 1},
        {name: 'water', mass: 350, count: 1},
        {name: 'salt', mass: 18, count: 1},
        {name: 'yeast', mass: 30, count: 1},
        {name: 'egg', mass: 150, count: 1},
        {name: 'sugar', mass: 30, count: 1},
        {name: 'milk', mass: 60, count: 1},
        {name: 'butter', mass: 80, count: 1},
        {name: 'fermentedDough', mass: 150, count: 1},
      ],
      respectusPanis: [
        {name: 'flour', mass: 800, count: 1},
        {name: 'water', mass: 670, count: 1},
        {name: 'flourT80', mass: 200, count: 1},
        {name: 'salt', mass: 17, count: 1},
        {name: 'sourdough', mass: 5, count: 1},
      ],
      meteille: [
        {name: 'flour', mass: 500, count: 1},
        {name: 'water', mass: 650, count: 1},
        {name: 'flourT170', mass: 500, count: 1},
        {name: 'salt', mass: 18, count: 1},
        {name: 'yeast', mass: 8, count: 1},
        {name: 'fermentedDough', mass: 250, count: 1},
      ],
      sourdoughJack: [
        {name: 'flour', mass: 900, count: 1},
        {name: 'water', mass: 620, count: 1},
        {name: 'sourdough', mass: 200, count: 1},
        {name: 'salt', mass: 16, count: 1},
      ],
      burgerJoshua: [
        {name: 'flour', mass: 320, count: 1},
        {name: 'water', mass: 0, count: 1},
        {name: 'waterRoux', mass: 120, count: 1},
        {name: 'milk', mass: 120, count: 1},
        {name: 'yeast', mass: 9, count: 1},
        {name: 'salt', mass: 7, count: 1},
        {name: 'sugar', mass: 35, count: 1},
        {name: 'egg', mass: 75, count: 1},
        {name: 'butter', mass: 42, count: 1},
      ],
      hokkaido: [
        {name: 'flour', mass: 580, count: 1},
        {name: 'water', mass: 0, count: 1},
        {name: 'waterRoux', mass: 240, count: 1},
        {name: 'milk', mass: 260, count: 1},
        {name: 'dryMilk', mass: 10, count: 1},
        {name: 'yeast', mass: 10, count: 1},
        {name: 'salt', mass: 12, count: 1},
        {name: 'sugar', mass: 60, count: 1},
        {name: 'egg', mass: 50, count: 1},
        {name: 'butter', mass: 50, count: 1},
      ],
      kebab: [
        {name: 'flour', mass: 500, count: 1},
        {name: 'water', mass: 300, count: 1},
        {name: 'milk', mass: 45, count: 1},
        {name: 'oliveOil', mass: 28, count: 1},
        {name: 'yeast', mass: 12, count: 1},
        {name: 'salt', mass: 8, count: 1},
        {name: 'sugar', mass: 3, count: 1},
      ],
    }
    const PLANNER_BOXES_PER_ROW = 24
    const client = axios.create({
      baseURL: 'https://pzuxxras84.execute-api.ap-southeast-1.amazonaws.com/prod',
      headers: {'X-Api-Key': 'dehGyRx3xN1wv3T2BI4cU2yjVrb6CaTVGA28UDwd'}
    });
    const i18n = new VueI18n({
      locale: 'en', // set locale
      messages, // set locale messages
    })
    const vuexLocal = new window.VuexPersistence.VuexPersistence({
      storage: window.localStorage,
    })
    const timeFormat = dt => dateFns.format(dt, 'HH:mm')
    const getNewBread = () => ({name: i18n.t('breads.pain')})
    const getNewIngredient = () => ({name: '', count: 1, hydration: [0, 0]})
    const itemsToTotal = items  => items.reduce((aggr, oI) => aggr + ((oI.count || 0) * (oI.mass || 0 )), 0)
    const urlParams = new URLSearchParams(window.location.search)
    const getEmptyBox = () => ({
      activity: 'none'
    })
    const reasonableNumber = (n) => numeral(n.toString()).format('0[.]0')
    const nEmptyBoxes = n => {
      return new Array(n).fill(0).map(() => getEmptyBox())
    }
    const activityTypes = ['none', 'PO', 'P', 'D', 'R', 'F', 'T', 'C', 'asterisk', 'doubleAsterisk']
    const oneRowOfEmptyBoxes = () => nEmptyBoxes(PLANNER_BOXES_PER_ROW)
    const say = (text, onend) => {
      const utter = new SpeechSynthesisUtterance(text);
      utter.onend = onend
      window.speechSynthesis.speak(utter)
    }
    let currentReadIndex = null
    const buildRecognition = function() {
      const grammar = '#JSGF V1.0; grammar measurements; public <measurement> = josh | joshua | measurement | first | second | one | two | three | four | five | six | seven | eight | nine | next | reset | previous;'
      const recognition = new webkitSpeechRecognition()
      const speechRecognitionList = new webkitSpeechGrammarList()
      speechRecognitionList.addFromString(grammar)
      recognition.continuous = true;
      recognition.lang = 'en-US';
      recognition.interimResults = true;
      recognition.maxAlternatives = 1;
      recognition.onaudiostart = (event) => console.log('starting', event)
      recognition.onend = (event) => Joshua.isOn ? recognition.start() : null
      return recognition
    }
    const Joshua = {
      beep: () => new Audio("data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=").play(),
      nBeep: async (n) => {
        for(let i=0; i < n; i++) {
          await Joshua.beep()
          await new Promise(resolve => setTimeout(resolve, 300))
        }
      },
      _on: false,
      _active: false,
      exitBeep() { Joshua.nBeep(2) },
      entryBeep() { Joshua.beep() },
      get isActive() { return Joshua._active },
      get isOn() {return Joshua._on},
      on() {
        Joshua._on = true
        Joshua.recognition.start()
      },
      off() {
        Joshua._on = false
        Joshua.recognition.stop()
      },
      isTrigger(heard) {
        console.log(heard)
        return heard.match(/(joshua|josh)/)
      },
      activate: _.debounce(() => {
        Joshua._active = true
        Joshua.recognition.abort()
        Joshua.entryBeep()
        Joshua.eventualDeactivate() // will only trigger after a few seconds, unless called again
      }, 2000, {leading: true}),
      deactivate: () => {
        console.log('deactivating')
        Joshua._active = false
        Joshua.exitBeep()
      },
      eventualDeactivate: _.debounce(() => Joshua.isActive ? Joshua.deactivate() : null, 3000),
      recognition: buildRecognition(),
    }
    document.addEventListener("DOMContentLoaded", function() {
    
    var vm = new Vue({
      i18n,
      el: '#app',
      data() {
        return {
          PLANNER_BOXES_PER_ROW,
          recipes: [],
          activityTypes,
          activeTab: 'coefficient',
          selectedRecipe: "",
          selectedRecipeObject: null,
          orderItems: [],
          recipeItems: [],
          poolishItems: [],
          roundToDecimal: '3',
          languages: [{
            name: 'Français',
            locale: 'fr'
          }, {name: 'English', locale: 'en'}],
          plannerBoxes: oneRowOfEmptyBoxes(),
          startAtHour: '08',
          startAtMinute: '00',
          joshuaOn: Joshua.isOn
        }
      },
      mounted() {
        const language = urlParams.get('lang')
        if(language) {
          this.$i18n.locale = language
        }

        Joshua.recognition.onresult = (event) => {
          const result = event.results.item(event.results.length - 1)
          const heard = result[0].transcript.toLowerCase()
          console.log('Heard', heard)
          let process = false // Lame way to later decide if we want to process the string
          if(Joshua.isActive) {
            Joshua.eventualDeactivate() // keepalive
            if(result.isFinal) {
              process = true
            }
          } else {
            if(Joshua.isTrigger(heard)) {
              Joshua.activate()
            }
          }
          if(!process) return
          let index = null;
          console.log('Processing', heard)
          let matches = heard.match(/(?:read )?(?:measurements?|ingredients?) (?:number )(?<n>\d|one|two|three|four|five|six|seven|eight)/)
          let key
          if(matches) {
            key = matches.groups.n
            console.log('Matching number', key)
            const n = parseInt(key)
            if(n === NaN) {
              index = {'one': 0, 'two': 1, 'three': 2, 'four': 3, 'five': 4, 'six': 5, 'seven': 6, 'eight': 7}[key]
            } else {
              index = n - 1
            }
          }
          matches = heard.match(/(?<greeting>who is the boss)/)
          if(matches) {
            console.log('Matching greeting')
            say('Audrey is the boss of course!')
          }
          matches = heard.match(/(?<greeting>hello)/)
          if(matches) {
            console.log('Matching greeting')
            say('Hi! It\'s good to be active again. Have fun baking')
          }
          matches = heard.match(/(?:read )?(?<ordinal>first|second|third|last) (?:measurements?|ingredients?)/)
          if(matches) {
            console.log('Matching first/second')
            index = {'first': 0, 'second': 1, 'third': 2, 'last': -10}[matches.groups.ordinal]
          }
          matches = heard.match(/(?:read )?(?<neighbour>next|previous|repeat)(?: measurements?| ingredients?)?/)
          if(matches) {
            console.log('Matching prev/next')
            if(currentReadIndex === null) {
              index = 0
            } else {
              const key = matches.groups.neighbour
              index = currentReadIndex + {'next': 1, 'previous': -1, 'repeat': 0}[key]
            }
          }
          matches = heard.match(/stop listening/)
          if(matches) {
            console.log('Stopping')
            Joshua.deactivate()
            this.toggleJoshua()
          }
          if(index !== null) {
            this.readMeasurement(index)
          } else {
            // This means "final" speech but not match
            Joshua.deactivate()
          }
        }
        const id = urlParams.get('id')
        // Load recipes
        client.get('boulangeriePasAPasDbGateway/recipes').then(resp => this.recipes = resp.data.Items)
        if(id) {
          client.get(`boulangeriePasAPasDbGateway?id=${id}`).then(resp => {
            const {orderItems, recipeItems, roundToDecimal, plannerBoxes} = resp.data.Item.state
            this.orderItems = orderItems
            this.recipeItems = recipeItems
            this.roundToDecimal = roundToDecimal
            this.plannerBoxes = plannerBoxes || oneRowOfEmptyBoxes()
          })
        } else {
          this.orderItems = [
            {name: this.$i18n.tc('breads.baguette', 1), mass: 340, count: 1},
          ]
          this.recipeItems = [
            {name: this.$i18n.t('ingredients.flour'), mass: 1000, count: 1, hydration: [1, 0]},
            {name: this.$i18n.t('ingredients.water'), mass: 620, count: 1, hydration: [0, 1]},
          ]
        }
        this.computePoolishItems(this.recipeItems)
      },
      watch: {
        recipeItems() {
          this.computePoolishItems(this.recipeItems, this.poolishItems)
        },
        orderItems() {
          this.computePoolishItems(this.recipeItems, this.poolishItems)
        },
        roundToDecimal() {
          this.computePoolishItems(this.recipeItems, this.poolishItems)
        },
        selectedRecipe(index) {
          if(index === "") {
            this.selectedRecipeObject = null
            return
          }
          this.selectedRecipeObject = this.recipes[index]
          this.recipeItems = this.recipeList[index].recipeItems
        }
      },
      computed: {
        totalOrderMass() {
          return itemsToTotal(this.orderItems)
        },
        startDateTime() {
          let d = new Date()
          d = dateFns.setHours(d, parseInt(this.startAtHour))
          return dateFns.setMinutes(d, parseInt(this.startAtMinute))
        },
        displayRecipePerKg() {
          return parseInt(this.flourRecipeMass) !== 1000
        },
        totalRecipeMass() {
          return itemsToTotal(this.recipeItems)
        },
        totalRecipeMassPerKg() {
          return Math.round(this.totalRecipeMass * 1000 / this.flourRecipeMass)
        },
        flourRecipeMass() {
          return this.recipeItems[0] ? this.recipeItems[0].mass : 0
        },
        getCoefficient() {
          const multiplier = Math.pow(10, this.roundToDecimal)
          return Math.ceil(this.totalOrderMass * multiplier / this.totalRecipeMass) / multiplier
        },
        getMeasurements() {
          return this.recipeItems.map(({mass, name}) => ({
            name,
            mass: mass * this.getCoefficient,
            hr: this.$i18n.t('boxes.coefficient.singleIngredient', {mass: reasonableNumber(mass * this.getCoefficient), name})
          }))
        },
        totalMeasurementsMass() {
          return reasonableNumber(itemsToTotal(this.recipeItems.map(({mass, count}) => ({mass, count: count*this.getCoefficient}))))
        },
        waterRouxItems() {
          if(!this.getMeasurements[0]) {
            return []
          }
          return [
            {name: this.$i18n.t('ingredients.flour'), waterRouxMass: this.getMeasurements[0].mass / 10, balanceMass: this.getMeasurements[0].mass * 9 / 10},
            {name: this.$i18n.t('ingredients.water'), waterRouxMass: this.getMeasurements[0].mass / 2, balanceMass: this.getMeasurements[1].mass - this.getMeasurements[0].mass / 2}
          ]
        },
        recipeList() {
          const lang = this.$i18n.locale
          return this.recipes.map(recipe => ({
            title: recipe.titleTranslations[lang],
            author: recipe.author,
            suggestedQuantities: recipe.suggestedQuantities,
            recipeItems: recipe.ingredients.map(({name, mass, count}) => {
              const translations = recipe.ingredientTranslations[lang]
              let translatedIngredient = translations[name]
              if(!translatedIngredient) {
                translatedIngredient = this.$i18n.t(`recipes.genericIngredients.${name}`)
              }
              return {mass, count, 
                name: translatedIngredient
              }
            })
          }))
        },
        rowedPlannerBoxes() {
          return _.chunk(this.plannerBoxes, PLANNER_BOXES_PER_ROW)
        },
        keyActivityTypes() {
          return activityTypes.slice(1)
        }
      },
      methods: {
        showSuggestedRecipes() {
          Swal.fire({
            icon: 'info',
            title: 'Suggested quantities',
            html: this.selectedRecipeObject.suggestedQuantities.map(({count, name, part, mass, quantity}) => `
            <h3>${name}</h3>
            <p>${count} ${part} each ${mass} g => ${quantity}</p>
            `).join('<br>')
          })
        },
        toggleJoshua() {
          Joshua.isOn ? Joshua.off() : Joshua.on()
          this.joshuaOn = Joshua.isOn
        },
        readMeasurement(index) {
          console.log(index)
          if(index === -1) {
            say('No previous measurement. Reading first item')
            index = 0
          }
          if(index === -10) {
            // Last item
            index = this.getMeasurements.length - 1
          }
          currentReadIndex = index
          const text = this.getMeasurements[index].hr.replace('g ', ' grams ')
          say(this.getMeasurements[index].hr.replace('g ', ' grams '), () => setTimeout(() => Joshua.deactivate(), 500))
        },
        computePoolishItems(newItems, oldItems) {
          const waterAmount = Math.round(this.getMeasurements[1].mass / 2)
          this.poolishItems = this.getMeasurements.map(({name, mass}, i) => ({
            name,
            day1Value: i <= 1 ? waterAmount : 0 // Water and flour
          }))
        },
        scrollTo(elementId) {
          Jump(`#${elementId}`, {offset: -10, duration: 750})
        },
        isOnTheDot(box) {
          return dateFns.getMinutes(this.boxTime(box)) === 0
        },
        boxTime(box) {
          const index = this.plannerBoxes.indexOf(box)
          return dateFns.addMinutes(this.startDateTime, 15*index)
        },
        boxTimeHr(box) {
          return timeFormat(this.boxTime(box))
        },
        addItem() {
          this.orderItems.push(getNewBread())
        },
        selectActivity(box) {
          const startDT = this.boxTime(box)
          const endDT = dateFns.addMinutes(startDT, 15)
          const initialActivity = box.activity
          Swal.fire({
            title: this.$i18n.t('prompts.selectActivity.title', {start: timeFormat(startDT), end: timeFormat(endDT)}),
            input: 'select',
            inputValue: initialActivity,
            inputOptions: _.fromPairs(activityTypes.map(t => [t, this.$i18n.t(`prompts.selectActivity.activities.${t}`)])),
          }).then(({value}) => box.activity = value || initialActivity)
        },
        copyActivity(box) {
          const index = this.plannerBoxes.indexOf(box)
          if(index === -1 || index === this.plannerBoxes.length - 1) {
            return
          }
          
          this.plannerBoxes[index+1].activity = this.plannerBoxes[index].activity
        },
        removeActivity(box) {
          box.activity = 'none'
        },
        saveState() {
          const params = new URLSearchParams(window.location.search)
          let id = params.get('id')
          if(!id) {
            id = uuid.v4()
          }
          const {recipeItems, orderItems, roundToDecimal, plannerBoxes} = this
          const data = {
            recipeItems, orderItems, roundToDecimal, plannerBoxes
          }
          client.post(`boulangeriePasAPasDbGateway?id=${id}`, data).then(resp => {
            const url = new URL(window.location)
            if(!url.searchParams.get('id')) {
              url.searchParams.append('id', id)
            }
            return Swal.fire({
              type: 'success',
              title: this.$i18n.t('prompts.save.title'),
              html: this.$i18n.t('prompts.save.html', {url: url.toString()}),
              onOpen(el) {
                new ClipboardJS('#copy_button')
              }
            })
          })
        },
        day2Value(i, poolishItem) {
          return parseInt(this.getMeasurements[i].mass - poolishItem.day1Value)
        },
        addIngredient() {
          this.recipeItems.push(getNewIngredient())
        },
        clearOrder() {
          Swal.fire({
            type: 'error',
            title: this.$i18n.t('prompts.clearOrder.title'),
            text: this.$i18n.t('prompts.clearOrder.text'),
            showCancelButton: true,
            confirmButtonText: this.$i18n.t('prompts.clearOrder.confirmButtonText'),
            cancelButtonText: this.$i18n.t('prompts.clearOrder.cancelButtonText'),
          }).then(result => result.value ? this.orderItems = [getNewBread()] : 0)
        },
        clearRecipe() {
          Swal.fire({
            type: 'error',
            title: this.$i18n.t('prompts.clearRecipe.title'),
            text: this.$i18n.t('prompts.clearRecipe.text'),
            showCancelButton: true,
            confirmButtonText: this.$i18n.t('prompts.clearRecipe.confirmButtonText'),
            cancelButtonText: this.$i18n.t('prompts.clearRecipe.cancelButtonText'),
          }).then(result => result.value ? this.recipeItems = [this.recipeItems[0], this.recipeItems[1]] : 0)
        },
        addRowOfPlannerBoxes() {
          this.plannerBoxes = this.plannerBoxes.concat(oneRowOfEmptyBoxes())
        }
      }
    })
  })
  </script>
</head>
<body>
  <div id="app">
    <section class="hero">
      <div class="hero-body">
        <div class="container">
          <h1 class="title">
            {{ $t('page.title') }}
          </h1>
          <h2 class="subtitle level">
            <div class="level-left">
              {{ $t('page.subtitle') }}&nbsp;<a href="https://www.youtube.com/watch?v=IZjUj8YzhLA">Boulangerie Pas a Pas #7</a>
              <select v-model="$i18n.locale">
                <option v-for="lang in languages" :key="lang.locale" :value="lang.locale">{{ lang.name }}</option>
              </select>
            </div>
            <div class="level-right">
                <button style="margin-right: 10px" title="Joshua: reads out measurements if you ask nicely" class="button" :class="{'is-primary': joshuaOn}" @click="toggleJoshua()">
                  <span class="icon is-small">
                    <i class="fas fa-robot"></i>
                  </span>
                </button>
                <a class="button level-item is-primary" :title="$t('save')" @click="saveState">
                  <i class="fas fa-save"></i>
                </a>
            </div>
          </h2>
        </div>
      </div>
    </section>
    <section class="section" id="tabs_section">
      <div class="container">
        <div class="tabs">
          <ul>
            <li :class="{'is-active': activeTab === 'coefficient'}" @click="activeTab = 'coefficient'"><a>{{ $t('boxes.coefficient.tabName') }}</a></li>
            <li :class="{'is-active': activeTab === 'optionalMethods'}" @click="activeTab = 'optionalMethods'"><a>{{ $t('boxes.poolish.tabName') }}</a></li>
            <li :class="{'is-active': activeTab === 'planner'}" @click="activeTab = 'planner'"><a>{{ $t('boxes.planner.tabName') }}</a></li>
            <li :class="{'is-active': activeTab === 'hydration'}" @click="activeTab = 'hydration'"><a>{{ $t('boxes.hydration.tabName') }}</a></li>
          </ul>
        </div>
        <div :hidden="activeTab !=='coefficient'">
          <div class="box" id="step1_box">
            <h2 class="level subtitle">
              <span class="level-item">1. {{$t('boxes.order.title')}}</span>
            </h2>
            <div class="div_table">
              <div class="level-left" v-for="(orderItem, i) in orderItems">
                <div class="level-item">
                  <div class="field is-horizontal">
                    <label class="label">#{{i+1}}</label>
                  </div>
                </div>
                <div class="level-item">
                  <p class="control">
                    <input class="input has-text-right coefficient_number" type="number" placeholder="1" v-model="orderItem.count">
                  </p>
                </div>
                <div class="level-item">
                  <p class="control">
                    <input class="input" type="text" placeholder="bread type" v-model="orderItem.name">
                  </p>
                </div>
                <div class="level-item has-text-right">, {{$t('boxes.order.each')}}
                </div>
                <div class="level-item">
                  <p class="control has-icons-right">
                    <input class="input has-text-right" type="number" v-model="orderItem.mass" placeholder="340">
                    <span class="icon is-small is-right">g</span>
                  </p>
                </div>
              </div>
              <div class="level-right total" >
                <p class="has-text-right is-size-3">
                  <b>TOTAL: {{totalOrderMass}}g</b>
                </p>
              </div>
              <div class="level">
                <a class="button level-item is-primary" :title="$t('boxes.order.addItem')" @click="addItem">
                  <i class="fas fa-plus"></i>
                </a>
                <a class="button level-item is-danger" :title="$t('boxes.order.clearOrder')" @click="clearOrder">
                  <i class="fas fa-trash-alt"></i>
                </a>
              </div>
              <div class="level">
                <a class="button is-white level-item" @click="scrollTo('step2_box')">
                  <i class="fas fa-chevron-down"></i>
                </a>
              </div>
            </div>
          </div>
          <div class="box" id="step2_box">
            <h2 class="level subtitle">
              <span class="level-item">2. {{ $t('boxes.recipe.title') }}</span>
            </h2>
            <div class="columns level-left">
              <div class="column is-one-third">
                <p class="control is-horizontal">{{ $t('boxes.recipe.selectRecipeBefore') }}
                  <select class="control" v-model="selectedRecipe">
                    <option value="">{{$t('boxes.recipe.selectRecipeSelect')}}</option>
                    <option v-for="(recipe, i) in recipeList" :key="i" :value="i">{{recipe.title}}</option>
                    <option value="">{{ $t('boxes.recipe.selectRecipeCustom') }}</option>
                  </select>
                </p>
                <p>{{ $t('boxes.recipe.selectRecipeAfter') }}</p>
              </div>
              <div class="column is-one-third">
                <div class="recipe-meta" v-if="selectedRecipeObject">
                  <div v-if="selectedRecipeObject.author">
                    <p><em>Author:</em> <a :href="selectedRecipeObject.author.url">{{ selectedRecipeObject.author.name }}</a></p>
                    <p v-if="selectedRecipeObject.link"><em>Link:</em> <a :href="selectedRecipeObject.link.url">{{selectedRecipeObject.link.title}}</a></p>
                  </div>
                </div>
              </div>
              <div class="column is-one-third">
                <div class="recipe-meta" v-if="selectedRecipeObject">
                  <div v-if="selectedRecipeObject.suggestedQuantities">
                    <button @click="showSuggestedRecipes()" class="button is-info">{{ $t('boxes.recipe.suggestedRecipesButton') }}</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="box">
              <div class="columns level-left" :key="i" v-for="(recipeItem, i) in recipeItems">
                <div class="column is-one-fifth level-item">
                  <div class="field is-horizontal">
                    <label class="label">#{{i+1}}</label>
                  </div>
                </div>
                <div class="column is-one-third">
                  <p class="control">
                    <input class="input" type="text" :readonly="i <= 1" placeholder="ingredient" v-model="recipeItem.name">
                  </p>
                </div>
                <div class="column is-one-third">
                  <p class="control has-icons-right">
                    <input class="input has-text-right" type="number" v-model="recipeItem.mass" placeholder="340">
                    <span class="icon is-small is-right">g</span>
                  </p>
                </div>
              </div>
              <div class="level-right total" >
                <p class="has-text-right is-size-3">
                  <b>TOTAL: {{totalRecipeMass}}g</b>
                </p>
              </div>
              <div class="level-right"  v-if="displayRecipePerKg">
                <p class="has-text-right is-size-3">
                  <b>TOTAL {{ $t('boxes.recipe.totalPerKg') }}: {{totalRecipeMassPerKg}}g</b>
                </p>
              </div>
              <div class="level">
                <a class="button level-item is-primary" :title="$t('boxes.recipe.addItem')" @click="addIngredient">
                  <i class="fas fa-plus"></i>
                </a>
                <a class="button level-item is-danger" :title="$t('boxes.recipe.clearRecipe')" @click="clearRecipe">
                  <i class="fas fa-trash-alt"></i>
                </a>
              </div>
              <div class="level">
                <a class="button is-white level-item" @click="scrollTo('step3_box')">
                  <i class="fas fa-chevron-down"></i>
                </a>
              </div>
            </div>
          </div>
          <div class="box" id="step3_box">
            <h2 class="level subtitle has-text-success">
              <span class="level-item">3. {{ $t('boxes.coefficient.title') }}</span>
            </h2>
            <div class="level">
              <div class="is-size-1 level-item has-text-success">{{getCoefficient}}</div>
            </div>
            <div class="level-left">
              <div class="field is-horizontal level-item">
                  {{ $t('boxes.coefficient.roundCoefficentToBefore') }}
                <p class="control">
                  <input id="roundToDecimalId" class="is-size-3" min="0" max="3" type="number" v-model="roundToDecimal">&nbsp;
                </p> {{ $t('boxes.coefficient.roundCoefficentToAfter') }} <small v-if="roundToDecimal === '0'" min="0">({{ $t('boxes.coefficient.roundCoefficentToUnit') }})</small></label>
              </div>
            </div>
            <div class="level">
              <a class="button is-white level-item" @click="scrollTo('step4_box')">
                <i class="fas fa-chevron-down"></i>
              </a>
            </div>
          </div>
          <div class="box" id="step4_box">
            <h2 class="level subtitle has-text-success">
              <span class="level-item">4. {{ $t('boxes.measurements.title') }}</span>
            </h2>
            <div class="level">
              <div class="level-left">
                <ol>
                  <li v-for="measurement in getMeasurements">
                    {{measurement.hr}}
                  </li>
                </ol>
              </div>
              <div class="level-item">
                <b>Total: {{totalMeasurementsMass}}g</b>
              </div>
            </div>
          </div>
          <div class="level">
            <a class="button is-white level-item" @click="scrollTo('step1_box')">
              <i class="fas fa-chevron-up"></i>&nbsp;{{ $t('boxes.coefficient.backTo1') }}
            </a>
          </div>
        </div>
        
        <div :hidden="activeTab !=='optionalMethods'">
          <div class="columns">
            <div class="level-left column box">
              <h2 class="level-item subtitle has-text-success">
                <span>{{ $t('boxes.poolish.title') }}</span>
              </h2>
              <div class="level">
                <table class="table is-bordered is-striped is-narrow">
                  <thead>
                    <tr>
                      <th></th>
                      <th v-html="$t('boxes.poolish.day1')"></th>
                      <th v-html="$t('boxes.poolish.day2')"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr v-for="(item, i) in poolishItems">
                      <td>{{item.name}}</td>
                      <td>
                        <p class="control has-icons-right">
                          <input :readonly="i<=1" v-model="item.day1Value" class="input has-text-right" type="number" min="0">
                          <span class="icon is-small is-right">g</span>
                        </p>
                      </td>
                      <td>{{day2Value(i, item)}} g</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="level-left column box">
                <h2 class="level-item subtitle has-text-success">
                  <span>{{ $t('boxes.waterRoux.title') }}</span>
                </h2>
                <div class="level">
                  <table class="table is-bordered is-striped is-narrow">
                    <thead>
                      <tr>
                        <th></th>
                        <th v-html="$t('boxes.waterRoux.waterRoux')"></th>
                        <th v-html="$t('boxes.waterRoux.balance')"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr v-for="(item, i) in waterRouxItems">
                        <td>{{item.name}}</td>
                        <td>
                          {{item.waterRouxMass}} g
                        </td>
                        <td>{{item.balanceMass}} g</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
        </div>
        <div :hidden="activeTab !=='planner'">
          <div class="level">
            <div class="field is-horizontal level-item level-left is-size-3">
              {{ $t('boxes.planner.startAt') }}&nbsp;
              <p class="control">
                <select v-model="startAtHour" class="control is-size-5">
                  <option value="00">00</option>
                  <option value="01">01</option>
                  <option value="02">02</option>
                  <option value="03">03</option>
                  <option value="04">04</option>
                  <option value="05">05</option>
                  <option value="06">06</option>
                  <option value="07">07</option>
                  <option value="08">08</option>
                  <option value="09">09</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                  <option value="20">20</option>
                  <option value="21">21</option>
                  <option value="22">22</option>
                  <option value="23">23</option>
                </select>
              </p>
            </div>
          </div>
          <div class="columns box">
            <div class="level-left column" id="planner_container">
              <div class="columns" v-for="(row, i) in rowedPlannerBoxes" :key="i">
                <div class="column planner-box" :class="['planner-box_activity-'+box.activity, {on_the_dot: isOnTheDot(box)}]" v-for="(box, j) in row" :key="PLANNER_BOXES_PER_ROW*i+j" @click="selectActivity(box)">
                  <div class="level">
                    <div class="level-left planner-box_time" v-if="isOnTheDot(box)">
                      <span>{{boxTimeHr(box)}}</span>
                    </div>
                  </div>
                  <div class="level">
                    <div class="level-item planner-box_activity">{{ $t('boxes.planner.shortActivities.' + box.activity)}}</div>
                  </div>
                  <div class="remove_activity" @click.stop="removeActivity(box)" v-if="$t('boxes.planner.shortActivities.' + box.activity)"><i class="far fa-times-circle"></i></div>
                  <div class="add_next" @click.stop="copyActivity(box)" v-if="$t('boxes.planner.shortActivities.' + box.activity)"><i class="far fa-arrow-alt-circle-right"></i></div>
                </div>
              </div>
              <div class="level">
                <a class="button level-item" :title="$t('add')" @click="addRowOfPlannerBoxes">
                  <i class="fas fa-plus"></i>
                </a>
              </div>
            </div>
          </div>
          <div>
              <h3>{{ $t('boxes.planner.key') }}</h3>
              <ul id="legend">
                <li :class="['planner-box_activity-'+a, 'legend']" v-for="a in keyActivityTypes">
                  <em>{{ $t('boxes.planner.shortActivities.' + a) }}:</em>
                  {{ $t('prompts.selectActivity.activities.' + a) }}
                </li>
              </ul>
            </div>
        </div>
        <div :hidden="activeTab !=='hydration'">
          <div class="level">

          </div>
        </div>
      </div>
    </section>
  </div>
</body>